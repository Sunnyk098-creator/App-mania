<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>App Mania - Digital Marketplace</title>
    <!-- Google Fonts for Poppins -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Firebase SDKs (v8.10.0) -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

    <style>
        /* --- GLOBAL STYLES --- */
        :root {
            --bg-light: #f0f0f0;
            --card-bg: #ffffff;
            --primary-color: #4285F4;
            --accent-color: #0f9d58;
            --error-color: #db4437;
            --text-dark: #202020;
            --text-light: #5f6368; 
            --header-height: 60px;
            --side-menu-width: 280px;
            --bottom-nav-height: 60px; 
        }

        * { box-sizing: border-box; font-family: 'Poppins', sans-serif; color: var(--text-dark); }
        body { margin: 0; padding: 0; min-height: 100vh; background-color: var(--bg-light); padding-top: var(--header-height); padding-bottom: var(--bottom-nav-height); display: flex; flex-direction: column; }
        
        h1, h2, h3 { color: var(--text-dark); margin-top: 0; font-weight: 600; }
        .primary-text { color: var(--primary-color); }
        
        .card-box { background: var(--card-bg); border: 1px solid #ddd; border-radius: 8px; padding: 20px; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1); margin: 15px auto; width: 100%; max-width: 900px; }

        input:not([type="checkbox"]), textarea, select { width: 100%; padding: 12px; margin-bottom: 20px; background: #ffffff; border: 1px solid #ccc; border-radius: 4px; font-size: 16px; outline: none; }
        input:focus, textarea:focus, select:focus { border: 1px solid var(--primary-color); box-shadow: 0 0 0 2px rgba(66, 133, 244, 0.3); }

        .btn-primary { background-color: var(--primary-color); border: none; color: white; padding: 10px 20px; border-radius: 4px; cursor: pointer; font-weight: 500; text-transform: uppercase; transition: opacity 0.3s; text-decoration: none; display: inline-block; box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2); }
        .btn-primary:hover { opacity: 0.9; }

        /* --- HEADER & NAV --- */
        header { position: fixed; top: 0; left: 0; width: 100%; height: var(--header-height); z-index: 1000; display: flex; align-items: center; justify-content: space-between; padding: 0 15px; background: var(--card-bg); box-shadow: 0 1px 4px rgba(0, 0, 0, 0.1); }
        header h1 { margin: 0; font-size: 1.8em; color: var(--primary-color); font-weight: 700; }
        .menu-icon { font-size: 30px; cursor: pointer; }
        
        #side-menu { height: 100%; width: 0; position: fixed; z-index: 1001; top: 0; right: 0; background-color: var(--card-bg); overflow-x: hidden; transition: 0.5s; padding-top: 60px; box-shadow: -2px 0 5px rgba(0, 0, 0, 0.1); }
        #side-menu a { padding: 15px 30px; text-decoration: none; font-size: 16px; display: block; border-bottom: 1px solid #eee; }
        
        /* --- CONTENT --- */
        .content-grid { padding: 20px 0; display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 15px; max-width: 1400px; margin: 0 auto; }
        @media (min-width: 600px) { .content-grid { grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 20px; } }

        .app-card { display: flex; flex-direction: column; align-items: center; text-align: center; padding: 15px; border: 1px solid #eee; border-radius: 12px; background: var(--card-bg); box-shadow: 0 1px 4px rgba(0, 0, 0, 0.05); transition: transform 0.2s; cursor: pointer; }
        .app-card:hover { transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); }
        .app-card img { width: 80px; height: 80px; border-radius: 15px; object-fit: cover; margin-bottom: 10px; border: 1px solid #ddd; }
        .app-card h3 { margin: 5px 0 2px 0; font-size: 1em; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 100%; }
        
        .rating-stars span { font-size: 1.2em; }
        .rating-stars .rated { color: #fbbc05 !important; }
        
        .tab-view { display: none; padding: 10px 15px; max-width: 1400px; margin: 0 auto; min-height: calc(100vh - var(--header-height) - var(--bottom-nav-height)); }
        .tab-view.active { display: block; }

        /* --- DETAIL VIEW --- */
        #item-detail-view { max-width: 800px; }
        .detail-header { display: flex; align-items: center; gap: 15px; padding: 20px; background: var(--card-bg); border-radius: 8px; margin-bottom: 20px; }
        .detail-header img { width: 100px; height: 100px; border-radius: 15px; }
        .detail-info h2 { font-size: 1.8em; margin-bottom: 5px; }
        .detail-download-btn { display: block; width: 100%; text-align: center; padding: 15px; margin-top: 20px; font-size: 1.1em; font-weight: 700; }
        .back-button { position: fixed; top: 15px; left: 15px; z-index: 1002; background: rgba(255, 255, 255, 0.8); border: none; border-radius: 50%; width: 40px; height: 40px; font-size: 1.5em; cursor: pointer; display: none; }

        /* --- REVIEW LIST STYLES (NEW) --- */
        .review-item { border-bottom: 1px solid #eee; padding: 15px 0; }
        .review-item:last-child { border-bottom: none; }
        .review-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px; }
        .review-user { font-weight: 600; font-size: 0.95em; }
        .review-date { font-size: 0.8em; color: var(--text-light); }
        .review-stars { color: #fbbc05; font-size: 0.9em; }
        .review-text { font-size: 0.95em; line-height: 1.4; color: #444; margin-top: 5px; }

        /* --- MODAL STYLES (NEW) --- */
        .modal { display: none; position: fixed; z-index: 2000; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.5); align-items: center; justify-content: center; }
        .modal-content { background-color: #fff; padding: 25px; border-radius: 12px; width: 90%; max-width: 400px; box-shadow: 0 4px 20px rgba(0,0,0,0.2); animation: popIn 0.3s ease; }
        @keyframes popIn { from { transform: scale(0.8); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        .modal-buttons { display: flex; justify-content: flex-end; gap: 10px; margin-top: 15px; }
        .btn-cancel { background: #eee; color: #333; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; }

        /* --- BOTTOM NAV --- */
        #bottom-nav { position: fixed; bottom: 0; left: 0; width: 100%; height: var(--bottom-nav-height); background: var(--card-bg); box-shadow: 0 -1px 4px rgba(0, 0, 0, 0.1); display: flex; justify-content: space-around; align-items: center; z-index: 1010; }
        .nav-item { display: flex; flex-direction: column; align-items: center; text-decoration: none; color: var(--text-light); font-size: 0.7em; cursor: pointer; padding: 5px 0; flex: 1; }
        .nav-item.active { color: var(--primary-color); font-weight: 600; }
    </style>
</head>
<body>
    
    <!-- REVIEW MODAL (NEW) -->
    <div id="review-modal" class="modal">
        <div class="modal-content">
            <h3 class="primary-text">Write a Review</h3>
            <p id="modal-rating-text">Rating: 0 Stars</p>
            <textarea id="modal-review-input" rows="4" placeholder="Tell everyone what you think about this app..." style="margin-bottom: 10px;"></textarea>
            <div class="modal-buttons">
                <button class="btn-cancel" onclick="closeReviewModal()">Cancel</button>
                <button class="btn-primary" onclick="submitReview()">Submit</button>
            </div>
        </div>
    </div>

    <div id="app-content-wrapper" class="user-app-container">
        <button id="back-btn" class="back-button" onclick="goBackToListView()">&#x2190;</button>

        <header>
            <h1 id="main-header-title">App Mania</h1>
            <span class="menu-icon" onclick="toggleNav()">&#9776;</span>
        </header>

        <div id="side-menu">
            <a href="javascript:void(0)" onclick="closeNav()" style="position: absolute; top: 0; right: 25px; font-size: 36px;">&times;</a>
            <a href="#" onclick="showAppView('all')">Home (All)</a>
            <a href="#" onclick="showAppView('profile')">User Profile</a>
            <a href="#" onclick="logoutUser()" style="color: var(--error-color);">Logout</a>
        </div>

        <div id="tab-views-container">
            <!-- 1. ALL VIEW -->
            <div id="all-view" class="tab-view active">
                <h2 class="primary-text" style="text-align: center;">All Apps & Games</h2>
                <div id="all-grid" class="content-grid"></div>
            </div>
            
            <!-- 2. GAMES VIEW -->
            <div id="games-view" class="tab-view">
                <h2 class="primary-text" style="text-align: center;">All Games</h2>
                <div id="games-grid" class="content-grid"></div>
            </div>

            <!-- 3. APPS VIEW -->
            <div id="apps-view" class="tab-view">
                <h2 class="primary-text" style="text-align: center;">All Apps</h2>
                <div id="apps-grid" class="content-grid"></div>
            </div>

            <!-- 4. SEARCH VIEW -->
            <div id="search-view" class="tab-view">
                <h2 class="primary-text" style="text-align: center; margin-bottom: 0;">Search</h2>
                <input type="text" id="search-input" placeholder="Search title..." class="card-box" oninput="renderSearchItems()">
                <div id="search-results-grid" class="content-grid"></div>
            </div>

            <!-- 5. PROFILE VIEW -->
            <div id="profile-view" class="tab-view">
                <div class="card-box">
                    <h2 class="primary-text">User Profile</h2>
                    <form id="profile-form">
                        <input type="text" id="profile-name" placeholder="Your Name" required>
                        <input type="email" id="profile-email" placeholder="Your Email" required readonly>
                        <button type="submit" class="btn-primary">Save Profile</button>
                        <p id="profile-message"></p>
                    </form>
                </div>
            </div>

            <!-- 8. ITEM DETAIL VIEW -->
            <div id="item-detail-view" class="tab-view">
                <div class="card-box">
                    <div class="detail-header">
                        <img id="detail-logo" src="" alt="App Logo">
                        <div class="detail-info">
                            <h2 id="detail-title"></h2>
                            <p id="detail-type" style="color: var(--text-light); margin: 0;"></p>
                            <div class="rating-stars" id="detail-stars"></div>
                        </div>
                    </div>
                    <a id="detail-download-link" href="#" target="_blank" class="btn-primary detail-download-btn">Download / Visit</a>
                    
                    <div class="card-box" style="margin-top: 20px; padding: 15px;">
                        <h3>Description</h3>
                        <p id="detail-description"></p>
                    </div>

                    <div class="card-box" style="margin-top: 20px;">
                        <h3>Rate this Item</h3>
                        <p style="font-size: 0.9em; color: #666;">Click a star to write a review.</p>
                        <div id="detail-rate-area"></div>
                    </div>

                    <!-- REVIEWS SECTION (NEW) -->
                    <div class="card-box" style="margin-top: 20px;">
                        <h3>User Reviews</h3>
                        <div id="reviews-list-container">
                            <p style="color: var(--text-light);">No reviews yet. Be the first to review!</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="bottom-nav">
        <a class="nav-item active" id="nav-all" onclick="showAppView('all')"><i style="font-style: normal; font-size: 24px;">üè†</i> Home</a>
        <a class="nav-item" id="nav-games" onclick="showAppView('games')"><i style="font-style: normal; font-size: 24px;">üéÆ</i> Games</a>
        <a class="nav-item" id="nav-apps" onclick="showAppView('apps')"><i style="font-style: normal; font-size: 24px;">üì±</i> Apps</a>
        <a class="nav-item" id="nav-search" onclick="showAppView('search')"><i style="font-style: normal; font-size: 24px;">üîé</i> Search</a>
    </div>

    <script>
        // --- FIREBASE CONFIGURATION ---
        const firebaseConfig = {
            apiKey: "AIzaSyBqrAnfkLx4a4BDsCNbBGa4tyuuhNt_vKI",
            authDomain: "app-store-11766.firebaseapp.com",
            databaseURL: "https://app-store-11766-default-rtdb.firebaseio.com",
            projectId: "app-store-11766",
            storageBucket: "app-store-11766.firebasestorage.app",
            messagingSenderId: "586580275943",
            appId: "1:586580275943:web:6005f1b4907b548666e842"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        
        // --- GUEST USER SETUP ---
        const GUEST_UID = "anonymous_user_123"; 
        const GUEST_NAME = "Guest User";
        const GUEST_EMAIL = "guest_user@appmania.com"; 

        if (!localStorage.getItem('userEmail')) {
            localStorage.setItem('userName', GUEST_NAME);
            localStorage.setItem('userEmail', GUEST_EMAIL);
        }
        
        // --- STATE VARIABLES ---
        let allItems = [];
        let currentListViewId = 'all'; 
        // Variables for Review System
        let pendingRatingValue = 0;
        let pendingItemId = null;
        
        // DOM Elements
        const sideMenu = document.getElementById('side-menu');
        const tabViews = document.querySelectorAll('.tab-view');
        const navItems = document.querySelectorAll('.nav-item');
        const backBtn = document.getElementById('back-btn');
        const searchInput = document.getElementById('search-input');
        const modal = document.getElementById('review-modal');

        // --- NAVIGATION LOGIC ---
        window.toggleNav = () => sideMenu.style.width = sideMenu.style.width === '280px' ? '0px' : '280px';
        window.closeNav = () => sideMenu.style.width = '0px';

        window.showAppView = (viewId) => {
            tabViews.forEach(view => view.classList.remove('active'));
            navItems.forEach(item => item.classList.remove('active'));
            
            document.getElementById(`${viewId}-view`).classList.add('active');
            const navItem = document.getElementById(`nav-${viewId}`);
            if (navItem) navItem.classList.add('active');
            
            if (viewId === 'item-detail') {
                backBtn.style.display = 'block';
                document.getElementById('main-header-title').textContent = 'Item Details';
                document.getElementById('bottom-nav').style.display = 'none';
            } else {
                backBtn.style.display = 'none';
                document.getElementById('main-header-title').textContent = 'App Mania';
                document.getElementById('bottom-nav').style.display = 'flex';
                if (['all', 'games', 'apps', 'search'].includes(viewId)) currentListViewId = viewId;
                
                // Reset URL when going to main views
                const currentUrl = new URL(window.location.href);
                if (currentUrl.searchParams.has('item')) {
                    currentUrl.searchParams.delete('item');
                    history.replaceState(null, '', currentUrl.pathname); 
                }
            }
            closeNav();

            if (viewId === 'all') renderItems('All', 'all-grid');
            else if (viewId === 'games') renderItems('Game', 'games-grid');
            else if (viewId === 'apps') renderItems('App', 'apps-grid');
            else if (viewId === 'search') { searchInput.value = ''; renderSearchItems(); }
            else if (viewId === 'profile') loadUserProfile();
        };

        window.goBackToListView = () => {
            const currentUrl = new URL(window.location.href);
            currentUrl.searchParams.delete('item');
            history.replaceState(null, '', currentUrl.pathname);
            showAppView(currentListViewId);
        };

        window.logoutUser = () => {
            alert("Logged out. Refreshing...");
            localStorage.clear();
            location.reload();
        };

        // --- ITEM DATA LOGIC ---
        db.ref('items').on('value', snapshot => {
            const items = snapshot.val();
            allItems = items ? Object.keys(items).map(key => ({ id: key, ...items[key] })) : [];
            
            // Re-render current view if data changes
            const activeView = document.querySelector('.tab-view.active').id;
            if(activeView === 'all-view') renderItems('All', 'all-grid');
            else if(activeView === 'games-view') renderItems('Game', 'games-grid');
            else if(activeView === 'apps-view') renderItems('App', 'apps-grid');
            else if(activeView === 'search-view') renderSearchItems();
            else if(activeView === 'item-detail-view') {
                // If in detail view, update stats only, don't full refresh to avoid input loss
                const urlParams = new URLSearchParams(window.location.search);
                const id = urlParams.get('item');
                if(id) {
                    const item = allItems.find(i => i.id === id);
                    if(item) {
                         document.getElementById('detail-stars').innerHTML = generateRatingStars(item.id, item.ratings);
                    }
                }
            }
        });

        // Initialize App (Handle Deep Links)
        const urlParams = new URLSearchParams(window.location.search);
        const initialId = urlParams.get('item');
        if (initialId) {
            // Need to wait for data to load once
            db.ref('items').once('value').then(snapshot => {
                const items = snapshot.val();
                allItems = items ? Object.keys(items).map(key => ({ id: key, ...items[key] })) : [];
                showItemDetail(initialId);
            });
        } else {
            showAppView('all');
        }

        // --- RENDER ITEMS ---
        function renderItems(filter, gridId) {
            const grid = document.getElementById(gridId);
            grid.innerHTML = '';
            
            const list = filter === 'All' 
                ? allItems.filter(i => i.type === 'Game' || i.type === 'App')
                : allItems.filter(i => i.type === filter);

            if(list.length === 0) { grid.innerHTML = '<p style="text-align:center; width:100%;">No items found.</p>'; return; }

            list.forEach(item => {
                grid.innerHTML += `
                    <div class="app-card" onclick="showItemDetail('${item.id}')">
                        <img src="${item.logoUrl}" alt="logo">
                        <h3>${item.title}</h3>
                        <small style="color:#666">${item.type}</small>
                        <div class="rating-stars">${generateRatingStars(item.id, item.ratings)}</div>
                    </div>`;
            });
        }

        window.renderSearchItems = () => {
            const term = searchInput.value.toLowerCase();
            const grid = document.getElementById('search-results-grid');
            if(term.length < 2) { grid.innerHTML = ''; return; }
            
            const list = allItems.filter(i => i.title.toLowerCase().includes(term));
            grid.innerHTML = '';
            list.forEach(item => {
                grid.innerHTML += `
                    <div class="app-card" onclick="showItemDetail('${item.id}')">
                        <img src="${item.logoUrl}" alt="logo">
                        <h3>${item.title}</h3>
                        <div class="rating-stars">${generateRatingStars(item.id, item.ratings)}</div>
                    </div>`;
            });
        };

        // --- DETAIL VIEW LOGIC ---
        window.showItemDetail = (itemId) => {
            const item = allItems.find(i => i.id === itemId);
            if (!item) return;

            // Update URL
            const url = new URL(window.location.href);
            url.searchParams.set('item', itemId);
            history.pushState({ itemId: itemId }, item.title, url);

            // Populate UI
            document.getElementById('detail-logo').src = item.logoUrl;
            document.getElementById('detail-title').textContent = item.title;
            document.getElementById('detail-type').textContent = item.type;
            document.getElementById('detail-description').textContent = item.description || item.contentHtml || 'No description.';
            document.getElementById('detail-download-link').href = item.downloadLink;
            
            // Ratings & Reviews
            document.getElementById('detail-stars').innerHTML = generateRatingStars(item.id, item.ratings);
            document.getElementById('detail-rate-area').innerHTML = generateRatingStars(item.id, item.ratings, true);
            
            // Attach Click Listeners for Rating
            attachRatingListeners();

            // Load Public Reviews
            loadReviews(itemId);

            showAppView('item-detail');
        };

        // --- NEW REVIEW SYSTEM ---

        function generateRatingStars(itemId, ratings, interactive = false) {
            const average = (ratings && ratings.count > 0) ? (ratings.total / ratings.count) : 0;
            const hasRated = localStorage.getItem(`rated_${itemId}`) === 'true';
            let html = '';
            
            for (let i = 1; i <= 5; i++) {
                const filled = i <= Math.round(average);
                const color = filled ? '#fbbc05' : '#ccc';
                // If interactive and not rated, make it clickable
                if (interactive) {
                    if (hasRated) {
                        html += `<span style="color:${color}; cursor:default;">‚òÖ</span>`;
                    } else {
                        html += `<span class="star-btn" data-value="${i}" data-id="${itemId}" style="color:${color}; cursor:pointer;">‚òÖ</span>`;
                    }
                } else {
                    html += `<span style="color:${color}">‚òÖ</span>`;
                }
            }
            
            if (interactive) {
                if (hasRated) html += `<br><small style="color:green">You have rated this.</small>`;
                else html += `<br><small>(${ratings ? ratings.count : 0} ratings, ${average.toFixed(1)})</small>`;
            }
            return html;
        }

        function attachRatingListeners() {
            document.querySelectorAll('.star-btn').forEach(btn => {
                btn.onclick = (e) => {
                    pendingRatingValue = parseInt(e.target.dataset.value);
                    pendingItemId = e.target.dataset.id;
                    openReviewModal();
                };
            });
        }

        function openReviewModal() {
            modal.style.display = 'flex';
            document.getElementById('modal-rating-text').textContent = `Rating: ${pendingRatingValue} Stars`;
            document.getElementById('modal-review-input').value = '';
        }

        window.closeReviewModal = () => {
            modal.style.display = 'none';
            pendingRatingValue = 0;
            pendingItemId = null;
        };

        window.submitReview = () => {
            const reviewText = document.getElementById('modal-review-input').value;
            const userName = localStorage.getItem('userName') || "Anonymous";
            
            if (!pendingItemId || pendingRatingValue === 0) return;

            // 1. Update Rating Count in DB (Transaction for safety)
            const itemRef = db.ref(`items/${pendingItemId}/ratings`);
            itemRef.transaction(currentData => {
                if (currentData === null) return { total: pendingRatingValue, count: 1 };
                return { total: currentData.total + pendingRatingValue, count: currentData.count + 1 };
            }, (error, committed) => {
                if (committed) {
                    // 2. Save Review to DB
                    const reviewData = {
                        user: userName,
                        rating: pendingRatingValue,
                        text: reviewText,
                        timestamp: Date.now()
                    };
                    db.ref(`reviews/${pendingItemId}`).push(reviewData);

                    // 3. Update Local Storage & UI
                    localStorage.setItem(`rated_${pendingItemId}`, 'true');
                    alert("Thank you for your review!");
                    closeReviewModal();
                    
                    // Refresh Detail View Area
                    const updatedItem = allItems.find(i => i.id === pendingItemId);
                    if(updatedItem) {
                        // Optimistic update until DB callback
                        if(!updatedItem.ratings) updatedItem.ratings = { total: 0, count: 0 };
                        updatedItem.ratings.total += pendingRatingValue;
                        updatedItem.ratings.count += 1;
                        document.getElementById('detail-rate-area').innerHTML = generateRatingStars(pendingItemId, updatedItem.ratings, true);
                    }
                } else {
                    alert("Error submitting rating: " + (error ? error.message : "Unknown error"));
                }
            });
        };

        function loadReviews(itemId) {
            const container = document.getElementById('reviews-list-container');
            container.innerHTML = '<p>Loading reviews...</p>';

            db.ref(`reviews/${itemId}`).on('value', snapshot => {
                const reviews = snapshot.val();
                container.innerHTML = '';

                if (!reviews) {
                    container.innerHTML = '<p style="color:var(--text-light)">No reviews yet. Be the first!</p>';
                    return;
                }

                // Convert to array and reverse to show newest first
                const reviewsArr = Object.values(reviews).reverse();
                
                reviewsArr.forEach(rev => {
                    // Create star string for review
                    let stars = '';
                    for(let i=0; i<5; i++) stars += i < rev.rating ? '‚òÖ' : '‚òÜ';

                    const date = new Date(rev.timestamp).toLocaleDateString();
                    
                    const div = document.createElement('div');
                    div.className = 'review-item';
                    div.innerHTML = `
                        <div class="review-header">
                            <span class="review-user">${rev.user}</span>
                            <span class="review-stars">${stars}</span>
                        </div>
                        <div class="review-date">${date}</div>
                        <div class="review-text">${rev.text || ''}</div>
                    `;
                    container.appendChild(div);
                });
            });
        }

        // --- PROFILE LOGIC ---
        function loadUserProfile() {
            document.getElementById('profile-name').value = localStorage.getItem('userName');
            document.getElementById('profile-email').value = localStorage.getItem('userEmail');
        }

        document.getElementById('profile-form').addEventListener('submit', (e) => {
            e.preventDefault();
            const name = document.getElementById('profile-name').value;
            localStorage.setItem('userName', name);
            // Also update in DB
            db.ref(`users/${GUEST_UID}`).update({ name: name });
            document.getElementById('profile-message').textContent = 'Saved!';
        });

    </script>
</body>
</html>